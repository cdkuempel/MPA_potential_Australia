---
title: "Untitled"
author: "Jade"
date: "2024-06-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Link for climetrics package - https://cran.r-project.org/package=climetrics 
```{r}
#install.packages("climetrics")
library(climetrics)
library(terra)
library(raster)

#install.packages("ncdf4")
library(ncdf4)

library(lubridate)

#This package unavailable for this version of R - find alternate if needed 
#install.packages("gdal_utils")
#library(gdal_utils)

library(sf)
library(here)
library(tidyverse)
```


#Download data 
Available from: https://s3-ap-southeast-2.amazonaws.com/aws-wps-prod/jobs/c7946c43-086c-46d0-9716-dc79c46c42b5/IMOS_aggregation_20240629T073820Z.zip
https://catalogue-imos.aodn.org.au/geonetwork/srv/eng/catalog.search#/metadata/d6f49c4a-8b75-4d05-acd4-b9c085bf4de0
```{r}
filename<- (here("raw_data/IMOS_temp/IMOS_aggregation_20240629T073820Z.nc"))

data <- nc_open(filename)
```

```{r}
#"https://www.metoffice.gov.uk/hadobs/hadisst/data/HadISST_sst.nc.gz"

filename <- here("raw_data/Climate_velocity/HadISST_sst.nc")
data <- nc_open(filename)
```

```{r}
sst_brick<- brick(filename)
```

#extract mean temp. per year
```{r}
years<-c(1916:2022)

for(i in 1:length(years)){
sub_x<-subset(x = names(sst_brick), grepl(years[i], names(sst_brick))) 
sub_sst<-subset(x = sst_brick, sub_x)
sub_sst_mean<-mean(sub_sst, na.rm = T)

writeRaster(sub_sst_mean, here(paste0("raw_data/Climate_velocity/SST_",years[[i]],".tif")), overwrite = T)
}

```


#create rast of mean temps
```{r}
sst_files<-list.files(here("raw_data/Climate_velocity"), pattern = ".tif", full.names = T)

sst<-rast(sst_files)

```

#find velocity
```{r}
ve <- gVelocity(sst)

#plot(ve)
```
```{r}
test<- rast(here("vel2.tif"))

plot(test)
```


#fit to aus data 
```{r}
ve_project<- project(ve, "epsg:3577")

#load in eez 
eez<- st_read(here("output_data/projected_eez.shp"))

ve_clip<- crop(ve_project, eez, mask = TRUE)

#plot(ve_clip)
```



```{r}
#load in capad 
capad<- 

capad_extract<-exactextractr::exact_extract(ve_clip, capad, "mean", progress = T)
```

